<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuckyPitch | Live Matches</title>
    <style>
        :root { 
            --primary: #00ff88; 
            --text: #ffffff; 
            --bg: #0d0d0d;
            --box-bg: rgba(255, 255, 255, 0.05); 
            --btn-bg: #cde1e3; 
            --btn-text: #000000; 
            --live: #ff4444; 
        }

        body.light { 
            --text: #111111; 
            --bg: #f4f7f6;
            --box-bg: rgba(0, 0, 0, 0.05); 
            --btn-bg: #111111; 
            --btn-text: #ffffff; 
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Segoe UI', sans-serif; }
        
        body { 
            min-height: 100vh; 
            background-color: var(--bg);
            color: var(--text); 
            transition: background 0.3s, color 0.3s; 
            padding-bottom: 50px; 
        }

        .container { max-width: 900px; margin: 0 auto; padding: 0 20px; }
        
        nav { display: flex; justify-content: space-between; align-items: center; padding: 30px 0; }
        .nav-right { display: flex; gap: 12px; }

        /* D√°tum v√°laszt√≥ */
        .date-selector { 
            display: flex; gap: 10px; margin-bottom: 30px; padding: 15px; 
            background: var(--box-bg); border-radius: 16px; overflow-x: auto;
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        }
        
        .date-btn { 
            background: transparent; border: 1px solid var(--text); color: var(--text); 
            padding: 10px 18px; border-radius: 12px; cursor: pointer; 
            font-size: 13px; white-space: nowrap; transition: 0.2s;
        }
        .date-btn.active { background: var(--btn-bg); color: var(--btn-text); border-color: var(--primary); font-weight: bold; }

        /* Liga szekci√≥ */
        .league-section { background: var(--box-bg); border-radius: 20px; margin-bottom: 25px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); }
        .league-header { padding: 15px 20px; background: rgba(255,255,255,0.03); font-weight: bold; font-size: 14px; color: var(--primary); letter-spacing: 1px; }
        
        /* Meccs sor */
        .match-row { 
            padding: 20px; display: grid; grid-template-columns: 1fr 140px 1fr; 
            align-items: center; border-top: 1px solid rgba(255,255,255,0.03);
            transition: background 0.2s;
        }
        .match-row:hover { background: rgba(255,255,255,0.02); }
        
        .score-box { text-align: center; }
        .score-num { font-size: 24px; color: var(--primary); font-weight: 800; letter-spacing: 2px; }

        .status-tag { font-size: 11px; font-weight: 900; text-transform: uppercase; margin-bottom: 4px; display: block; }
        .status-tag.live { color: var(--live); animation: pulse 1.5s infinite; }

        /* Gombok */
        .analyze-btn { 
            width: 100%; margin-top: 12px; padding: 8px; font-size: 11px; 
            background: var(--primary); color: #000; border: none; 
            border-radius: 8px; cursor: pointer; font-weight: 800; transition: transform 0.2s;
        }
        .analyze-btn:hover { transform: scale(1.05); }
        
        .icon-btn { 
            background: var(--box-bg); color: var(--text); border: none; 
            width: 40px; height: 40px; border-radius: 12px; cursor: pointer; 
            font-size: 18px; display: flex; align-items: center; justify-content: center;
        }

        .crest { width: 35px; height: 35px; object-fit: contain; }
        .team-box { display: flex; align-items: center; gap: 15px; font-weight: 600; font-size: 16px; }
        .team-box.home { justify-content: flex-end; text-align: right; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        
        .back-link { text-decoration: none; color: var(--text); font-weight: bold; font-size: 14px; }
    </style>
</head>
<body class="dark">
    <div class="container">
        <nav>
            <div style="font-size: 26px; font-weight: 900; color: var(--primary);">LUCKYPITCH</div>
            <div class="nav-right">
                <button class="icon-btn" onclick="toggleTheme()" id="theme-icon">‚òÄÔ∏è</button>
                <button class="icon-btn" onclick="toggleLang()" id="lang-btn" style="font-size: 12px; font-weight: bold;">HU</button>
                <a href="/" class="back-link" id="back-txt" style="display: flex; align-items: center; margin-left: 10px;">‚Üê VISSZA</a>
            </div>
        </nav>

        <div id="date-selector" class="date-selector"></div>
        <div id="app-content"></div>
    </div>

    <script>
        const translations = {
            hu: { back: "‚Üê VISSZA", analyze: "ELEMZ√âS", ft: "V√âGE", ht: "SZ√úNET", today: "MA", empty: "Nincs m√©rk≈ëz√©s ezen a napon." },
            en: { back: "‚Üê BACK", analyze: "ANALYZE", ft: "FT", ht: "HT", today: "TODAY", empty: "No matches for this day." }
        };

        let currentLang = localStorage.getItem("lang") || "hu";
        let selectedDate = new Date().toISOString().split('T')[0];
        let allMatches = [];

        async function fetchData() {
            try {
                const res = await fetch("/live-matches?t=" + Date.now());
                const data = await res.json();
                allMatches = data.matches || [];
                renderUI();
            } catch (err) { console.error("Hiba:", err); }
        }

        function getMatchDisplayTime(m) {
            if (m.status === "FINISHED") return translations[currentLang].ft;
            if (m.status === "PAUSED") return translations[currentLang].ht;
            if (m.status === "IN_PLAY") {
                const start = new Date(m.utcDate);
                const diffMin = Math.floor((new Date() - start) / 60000);
                if (diffMin >= 45 && diffMin < 60) return translations[currentLang].ht;
                if (diffMin >= 60) {
                    const corrected = diffMin - 15;
                    return corrected > 90 ? "90+'" : corrected + "'";
                }
                return diffMin > 0 ? diffMin + "'" : "1'";
            }
            return new Date(m.utcDate).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        function renderUI() {
            // Sz√∂vegek friss√≠t√©se
            document.getElementById("lang-btn").innerText = currentLang.toUpperCase();
            document.getElementById("back-txt").innerText = translations[currentLang].back;

            const selector = document.getElementById("date-selector");
            if (selector.innerHTML === "" && allMatches.length > 0) {
                const dates = [...new Set(allMatches.map(m => m.utcDate.split('T')[0]))].sort();
                dates.forEach(d => {
                    const btn = document.createElement("button");
                    btn.className = `date-btn ${d === selectedDate ? 'active' : ''}`;
                    const isToday = d === new Date().toISOString().split('T')[0];
                    btn.innerText = isToday ? translations[currentLang].today : d.substring(5).replace('-', '.');
                    btn.onclick = () => { selectedDate = d; renderUI(); };
                    selector.appendChild(btn);
                });
            }

            // Gombok akt√≠v √°llapot√°nak friss√≠t√©se
            document.querySelectorAll('.date-btn').forEach(btn => {
                const btnDate = allMatches.find(m => {
                    const isToday = m.utcDate.split('T')[0] === new Date().toISOString().split('T')[0];
                    return (isToday ? translations[currentLang].today : m.utcDate.substring(5, 10).replace('-', '.')) === btn.innerText;
                });
                btn.classList.toggle('active', btn.innerText.includes(selectedDate.substring(5).replace('-', '.')) || (btn.innerText === translations[currentLang].today && selectedDate === new Date().toISOString().split('T')[0]));
            });

            const container = document.getElementById("app-content");
            const filtered = allMatches.filter(m => m.utcDate.startsWith(selectedDate));
            
            if (filtered.length === 0) {
                container.innerHTML = `<div class="empty-msg" style="text-align:center; padding:50px; opacity:0.5;">${translations[currentLang].empty}</div>`;
                return;
            }

            const leagueMap = {};
            filtered.forEach(m => {
                if (!leagueMap[m.competition.name]) leagueMap[m.competition.name] = [];
                leagueMap[m.competition.name].push(m);
            });

            let html = "";
            for (const league in leagueMap) {
                html += `
                <div class="league-section">
                    <div class="league-header">${league.toUpperCase()}</div>
                    ${leagueMap[league].map(m => `
                        <div class="match-row">
                            <div class="team-box home">${m.homeTeam.shortName || m.homeTeam.name} <img src="${m.homeTeam.crest}" class="crest"></div>
                            <div class="score-box">
                                <span class="status-tag ${m.status === 'IN_PLAY' ? 'live' : ''}">${getMatchDisplayTime(m)}</span>
                                <span class="score-num">${m.score.fullTime.home ?? 0}:${m.score.fullTime.away ?? 0}</span>
                                <button class="analyze-btn" onclick="location.href='/elemzes?id=${m.id}'">${translations[currentLang].analyze}</button>
                            </div>
                            <div class="team-box away"><img src="${m.awayTeam.crest}" class="crest"> ${m.awayTeam.shortName || m.awayTeam.name}</div>
                        </div>
                    `).join('')}
                </div>`;
            }
            container.innerHTML = html;
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('light');
            document.getElementById("theme-icon").innerText = isDark ? "üåô" : "‚òÄÔ∏è";
            localStorage.setItem("theme", isDark ? "light" : "dark");
        }

        function toggleLang() {
            currentLang = currentLang === "hu" ? "en" : "hu";
            localStorage.setItem("lang", currentLang);
            document.getElementById("date-selector").innerHTML = ""; 
            renderUI();
        }

        // Alap√©rtelmezett t√©ma bet√∂lt√©se
        if (localStorage.getItem("theme") === "light") toggleTheme();

        fetchData();
        setInterval(fetchData, 20000);
    </script>
</body>
</html>
