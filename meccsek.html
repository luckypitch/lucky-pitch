<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Live Matches</title>

<style>
body{
  background:#0b0f1a;
  color:white;
  font-family:Arial;
  padding:20px;
}

button{
  margin:5px;
  padding:8px 14px;
  cursor:pointer;
}

.match{
  background:#121a2b;
  margin-bottom:15px;
  padding:15px;
  border-radius:10px;
  transition:0.3s;
}

.goalFlash{
  animation:flash 0.8s;
}

@keyframes flash{
  0%{background:#00ffcc;}
  100%{background:#121a2b;}
}

.bar{
  width:100%;
  height:8px;
  background:#222;
  border-radius:5px;
  overflow:hidden;
  margin-top:8px;
}

.progress{
  height:100%;
  background:#00ffcc;
  width:0%;
  transition:0.4s;
}
</style>
</head>

<body>

<h2 id="title">Live meccsek</h2>

<button onclick="setLang('hu')">HU</button>
<button onclick="setLang('en')">EN</button>

<div id="date"></div>
<br>

<div id="matches"></div>

<script>
let lang = "hu";
let lastScores = {};

function setLang(l){
  lang=l;
  render();
}

function nowDate(){
  const d=new Date();
  return d.toLocaleString();
}

function getMinute(match){

  if(match.minute) return match.minute;

  if(match.status==="IN_PLAY" || match.status==="PAUSED"){
    const start=new Date(match.utcDate);
    const diff=Math.floor((Date.now()-start)/60000);
    return Math.max(0,diff);
  }

  return null;
}

function formatMinute(min){

  if(min<=45) return min+"'";

  if(min<=90) return "45+"+(min-45)+"'";

  return "90+"+(min-90)+"'";
}

function playGoalSound(){
  const ctx=new AudioContext();
  const osc=ctx.createOscillator();
  osc.connect(ctx.destination);
  osc.start();
  setTimeout(()=>osc.stop(),200);
}

let dataCache=null;

async function load(){

  const res=await fetch("/live-matches?"+Date.now());
  dataCache=await res.json();
  render();
}

function render(){

  document.getElementById("title").innerText =
    lang==="hu" ? "Live meccsek" : "Live matches";

  document.getElementById("date").innerText =
    nowDate();

  const container=document.getElementById("matches");
  container.innerHTML="";

  if(!dataCache?.matches) return;

  dataCache.matches.forEach(m=>{

    const id=m.id;
    const home=m.homeTeam.name;
    const away=m.awayTeam.name;

    const score =
      (m.score.fullTime.home ?? 0)+"-"+(m.score.fullTime.away ?? 0);

    if(lastScores[id] && lastScores[id]!==score){
      playGoalSound();
    }

    const div=document.createElement("div");
    div.className="match";

    if(lastScores[id] && lastScores[id]!==score){
      div.classList.add("goalFlash");
    }

    lastScores[id]=score;

    const minute=getMinute(m);

    const percent=minute
      ? Math.min(minute/90*100,100)
      : 0;

    div.innerHTML=`
      <b>${home} vs ${away}</b><br>
      ${score}<br>
      ${minute ? formatMinute(minute) : ""}
      <div class="bar">
        <div class="progress" style="width:${percent}%"></div>
      </div>
    `;

    container.appendChild(div);
  });
}

loa
