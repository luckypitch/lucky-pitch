<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuckyPitch | Meccsek</title>
    <script async crossorigin="anonymous" data-clerk-publishable-key="pk_test_YWxsb3dlZC1pbnNlY3QtOTguY2xlcmsuYWNjb3VudHMuZGV2JA" src="https://allowed-insect-98.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js" type="text/javascript"></script>

    <style>
        :root { --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7); --text: #f8fafc; --primary: #00ff88; --secondary: #94a3b8; }
        body.light { --bg: #f1f5f9; --card-bg: rgba(255, 255, 255, 0.9); --text: #0f172a; --secondary: #475569; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text); transition: 0.3s; min-height: 100vh; }
        
        nav { display: flex; justify-content: space-between; align-items: center; padding: 1rem 5%; background: rgba(0,0,0,0.2); backdrop-filter: blur(10px); sticky: top; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); text-decoration: none; }
        .nav-actions { display: flex; gap: 1rem; align-items: center; }

        button { padding: 0.5rem 1rem; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; background: var(--card-bg); color: var(--text); }
        .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
        h2 { margin-bottom: 1.5rem; border-left: 4px solid var(--primary); padding-left: 15px; }

        .match-grid { display: grid; gap: 1rem; }
        .match-card { background: var(--card-bg); border-radius: 16px; padding: 1.5rem; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(255,255,255,0.05); }
        
        .team-info { display: flex; flex-direction: column; align-items: center; width: 35%; gap: 8px; }
        .team-logo { width: 40px; height: 40px; object-fit: contain; }
        .match-details { text-align: center; width: 30%; }
        .score { font-size: 1.5rem; font-weight: 900; color: var(--primary); }
        .match-time { font-size: 0.75rem; color: var(--secondary); margin-top: 5px; }
        
        .btn-elemzes { display: block; margin-top: 10px; padding: 6px 12px; background: var(--primary); color: #000; border-radius: 6px; text-decoration: none; font-size: 0.8rem; font-weight: bold; text-align: center; }
        .loading { text-align: center; padding: 3rem; color: var(--secondary); }
    </style>
</head>
<body>

<nav>
    <a href="/" class="logo">LuckyPitch</a>
    <div class="nav-actions">
        <button onclick="toggleTheme()" id="theme-btn">‚òÄÔ∏è</button>
        <button onclick="toggleLang()" id="lang-btn">HU üá≠üá∫</button>
        <div id="user-button"></div>
    </div>
</nav>

<div class="container">
    <h2 id="page-title">K√∂zelg≈ë Meccsek</h2>
    <div id="match-list" class="match-grid">
        <div class="loading" id="loading-text">Meccsek bet√∂lt√©se...</div>
    </div>
</div>

<script>
    const translations = {
        hu: {
            title: "Meccsek & Eredm√©nyek",
            loading: "Meccsek bet√∂lt√©se...",
            langBtn: "EN üá¨üáß",
            noMatch: "Nincs el√©rhet≈ë meccs.",
            analysis: "Elemz√©s",
            statusTimed: "K√©s≈ëbb",
            statusLive: "√âL≈ê"
        },
        en: {
            title: "Matches & Results",
            loading: "Loading matches...",
            langBtn: "HU üá≠üá∫",
            noMatch: "No matches available.",
            analysis: "Analysis",
            statusTimed: "Timed",
            statusLive: "LIVE"
        }
    };

    async function init() {
        await Clerk.load();
        if (Clerk.user) {
            Clerk.mountUserButton(document.getElementById('user-button'));
        }
        updateUI();
        loadMatches();
    }

    async function loadMatches() {
        const lang = localStorage.getItem('lang') || 'hu';
        const list = document.getElementById('match-list');
        try {
            const response = await fetch('/live-matches');
            const data = await response.json();

            if (!data.matches || data.matches.length === 0) {
                list.innerHTML = `<div class="loading">${translations[lang].noMatch}</div>`;
                return;
            }

            list.innerHTML = '';
            data.matches.forEach(match => {
                const matchDate = new Date(match.utcDate).toLocaleString(lang === 'hu' ? 'hu-HU' : 'en-US', {
                    month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
                });

                const html = `
                    <div class="match-card">
                        <div class="team-info">
                            <img src="${match.homeTeam.crest}" class="team-logo" onerror="this.src='https://via.placeholder.com/40'">
                            <span style="font-weight:bold; text-align:center;">${match.homeTeam.shortName || match.homeTeam.name}</span>
                        </div>
                        <div class="match-details">
                            <div class="score">${match.score.fullTime.home ?? 0} - ${match.score.fullTime.away ?? 0}</div>
                            <div class="match-time">${matchDate}</div>
                            <a href="/elemzes" class="btn-elemzes">${translations[lang].analysis}</a>
                        </div>
                        <div class="team-info">
                            <img src="${match.awayTeam.crest}" class="team-logo" onerror="this.src='https://via.placeholder.com/40'">
                            <span style="font-weight:bold; text-align:center;">${match.awayTeam.shortName || match.awayTeam.name}</span>
                        </div>
                    </div>
                `;
                list.insertAdjacentHTML('beforeend', html);
            });
        } catch (err) {
            list.innerHTML = '<div class="loading">Hiba t√∂rt√©nt.</div>';
        }
    }

    function updateUI() {
        const lang = localStorage.getItem('lang') || 'hu';
        const theme = localStorage.getItem('theme') || 'dark';
        
        document.body.classList.toggle('light', theme === 'light');
        document.getElementById('theme-btn').innerText = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        document.getElementById('lang-btn').innerText = translations[lang].langBtn;
        document.getElementById('page-title').innerText = translations[lang].title;
        document.getElementById('loading-text').innerText = translations[lang].loading;
    }

    function toggleLang() {
        const cur = localStorage.getItem('lang') || 'hu';
        localStorage.setItem('lang', cur === 'hu' ? 'en' : 'hu');
        updateUI();
        loadMatches(); // Friss√≠tj√ºk a k√°rty√°kat is a v√°lasztott nyelven
    }

    function toggleTheme() {
        const cur = localStorage.getItem('theme') || 'dark';
        localStorage.setItem('theme', cur === 'dark' ? 'light' : 'dark');
        updateUI();
    }

    window.addEventListener('load', init);
</script>
</body>
</html>
