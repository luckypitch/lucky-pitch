<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuckyPitch | Profi Elemz≈ë K√∂zpont</title>
    <style>
        :root { 
            --primary: #00ff88; 
            --text: #f8fafc; 
            --box-bg: rgba(15, 23, 42, 0.98);
            --cl-gs: #0044ff; --cl-q: #6699ff;
            --el-gs: #cc7a00; --el-q: #ffb366;
            --ecl-gs: #00cc6a; --ecl-q: #80ffc4;
            --po: #d35400; --rel: #e74c3c;
        }

        body { background: #0f172a; color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        
        /* FIX√ÅLT VISSZA GOMB */
        .back-nav { margin-bottom: 20px; }
        .back-btn { 
            display: inline-flex; align-items: center; gap: 8px;
            color: var(--primary); text-decoration: none; font-weight: bold; 
            background: rgba(0, 255, 136, 0.1); padding: 12px 24px; 
            border-radius: 12px; border: 1px solid var(--primary); transition: 0.3s;
        }
        .back-btn:hover { background: var(--primary); color: #000; }

        .match-card { 
            background: var(--box-bg); padding: 35px; border-radius: 24px; 
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex; justify-content: space-around; align-items: center; 
            margin-bottom: 30px; text-align: center; 
        }
        .team-box img { width: 70px; height: 70px; object-fit: contain; margin-bottom: 12px; }
        .score-box { display: flex; flex-direction: column; gap: 10px; }
        .score { font-size: 3.5rem; font-weight: 900; color: var(--primary); }
        .match-status { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px; color: #64748b; }
        .live-dot { display: inline-block; width: 8px; height: 8px; background: #ff4d4d; border-radius: 50%; margin-right: 5px; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .grid { display: grid; grid-template-columns: 1fr 350px; gap: 25px; }
        @media (max-width: 1200px) { .grid { grid-template-columns: 1fr; } }

        .card { background: var(--box-bg); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); overflow-x: auto; }
        h3.title { color: var(--primary); margin: 0 0 20px 0; font-size: 1rem; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }

        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; font-size: 13px; min-width: 850px; }
        td { padding: 12px 10px; background: rgba(255,255,255,0.02); text-align: center; }
        .team-col { text-align: left; min-width: 200px; font-weight: 600; }
        .pos-col { width: 80px; border-left: 4px solid transparent; }
        .zone-tag { font-size: 8px; font-weight: 900; display: block; margin-bottom: 2px; }
        .pos-num { display: inline-block; width: 24px; height: 24px; line-height: 24px; border-radius: 6px; background: rgba(255,255,255,0.1); font-weight: bold; }
        
        .highlight td { background: rgba(0, 255, 136, 0.1) !important; }
        .pts-bold { font-weight: 900; color: var(--primary); }

        .odd-item { 
            background: rgba(255,255,255,0.02); padding: 18px; border-radius: 15px; 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.05); 
        }
        .odd-val { color: var(--primary); font-size: 1.4rem; font-weight: 800; }
    </style>
</head>
<body>

<div class="container">
    <nav class="back-nav">
        <a href="/" class="back-btn">‚Üê VISSZA A MECCSEKHEZ</a>
    </nav>

    <div id="header-target"></div>

    <div class="grid">
        <div class="card">
            <h3 class="title">üèÜ Bajnoki Tabella</h3>
            <div id="standings-target">Bet√∂lt√©s...</div>
        </div>
        
        <div class="card">
            <h3 class="title">üìà √âl≈ë Oddsok</h3>
            <div id="odds-target">Keres√©s...</div>
        </div>
    </div>
</div>

<script>
    const matchId = new URLSearchParams(window.location.search).get('id');

    function getStatusColor(text) {
        if (!text) return "transparent";
        text = text.toLowerCase();
        if (text.includes("champions league")) return text.includes("qualifiers") ? "var(--cl-q)" : "var(--cl-gs)";
        if (text.includes("europa league")) return text.includes("qualifiers") ? "var(--el-q)" : "var(--el-gs)";
        if (text.includes("conference league")) return "var(--ecl-q)";
        if (text.includes("relegation") || text.includes("kies√©s")) return "var(--rel)";
        return "transparent";
    }

    async function init() {
        try {
            const res = await fetch('/live-matches');
            const data = await res.json();
            const match = data.matches.find(m => m.id == matchId);
            if (!match) return;

            // ID≈êPONT VAGY LIVE KEZEL√âSE
            let statusHtml = "";
            if (match.status === "IN_PLAY" || match.status === "PAUSED") {
                statusHtml = `<span class="live-dot"></span> LIVE EVENT`;
            } else {
                const date = new Date(match.utcDate);
                statusHtml = `KEZD√âS: ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            }

            document.getElementById('header-target').innerHTML = `
                <div class="match-card">
                    <div class="team-box"><img src="${match.homeTeam.crest}"><h3>${match.homeTeam.name}</h3></div>
                    <div class="score-box">
                        <div class="score">${match.score.fullTime.home ?? 0}:${match.score.fullTime.away ?? 0}</div>
                        <div class="match-status">${statusHtml}</div>
                    </div>
                    <div class="team-box"><img src="${match.awayTeam.crest}"><h3>${match.awayTeam.name}</h3></div>
                </div>`;

            loadStandings(match.competition.code, match.homeTeam.name, match.awayTeam.name);
            loadOdds(match.homeTeam.name, match.awayTeam.name);
        } catch (e) { console.error(e); }
    }

    async function loadStandings(code, home, away) {
        try {
            const res = await fetch(`/api/standings/${code}`);
            const data = await res.json();
            const table = data.standings.find(s => s.type === 'TOTAL').table;
            
            let html = `<table><thead><tr><th>#</th><th class="team-col">Csapat</th><th>M</th><th>GY</th><th>D</th><th>V</th><th>G√ìL</th><th>GK</th><th class="pts-bold">P</th></tr></thead><tbody>`;

            table.forEach(r => {
                let status = r.description || "";
                const color = getStatusColor(status);
                const isMatchTeam = (home.includes(r.team.name) || r.team.name.includes(home) || away.includes(r.team.name) || r.team.name.includes(away));

                html += `<tr class="${isMatchTeam ? 'highlight' : ''}">
                    <td class="pos-col" style="border-left-color: ${color}">
                        <span class="pos-num">${r.position}</span>
                    </td>
                    <td class="team-col"><img src="${r.team.crest}" width="20" style="vertical-align:middle; margin-right:10px;"> ${r.team.name}</td>
                    <td>${r.playedGames}</td><td>${r.won}</td><td>${r.draw}</td><td>${r.lost}</td>
                    <td>${r.goalsFor}:${r.goalsAgainst}</td>
                    <td style="color:${r.goalDifference >= 0 ? 'var(--primary)' : '#ff4d4d'}">${r.goalDifference > 0 ? '+'+r.goalDifference : r.goalDifference}</td>
                    <td class="pts-bold">${r.points}</td>
                </tr>`;
            });
            document.getElementById('standings-target').innerHTML = html + "</tbody></table>";
        } catch (e) { }
    }

    async function loadOdds(home, away) {
        try {
            const res = await fetch('/api/odds-data');
            const data = await res.json();
            const homeBase = home.split(' ')[0];
            const m = data.find(o => o.home_team.includes(homeBase) || o.away_team.includes(homeBase));
            if (m && m.bookmakers[0]) {
                const outcomes = m.bookmakers[0].markets[0].outcomes;
                document.getElementById('odds-target').innerHTML = `
                    <div class="odd-item"><span>Hazai (1)</span><span class="odd-val">${outcomes.find(x=>x.name===m.home_team)?.price || '-'}</span></div>
                    <div class="odd-item"><span>D√∂ntetlen (X)</span><span class="odd-val">${outcomes.find(x=>x.name==='Draw')?.price || '-'}</span></div>
                    <div class="odd-item"><span>Vend√©g (2)</span><span class="odd-val">${outcomes.find(x=>x.name===m.away_team)?.price || '-'}</span></div>`;
            } else { document.getElementById('odds-target').innerHTML = "<p style='text-align:center; opacity:0.5;'>Nincs el√©rhet≈ë odds.</p>"; }
        } catch (e) { }
    }
    init();
</script>
</body>
</html>
