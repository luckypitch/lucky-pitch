<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>LuckyPitch | Elemzés</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #00ff88; --text: #f8fafc; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .match-header { background: var(--card); padding: 30px; border-radius: 20px; display: flex; justify-content: space-around; align-items: center; margin-bottom: 20px; text-align: center; }
        .team-big img { width: 80px; height: 80px; }
        .analysis-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .info-card { background: var(--card); padding: 20px; border-radius: 15px; }
        .back-btn { text-decoration: none; color: var(--primary); font-weight: bold; display: inline-block; margin-bottom: 20px; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .highlight { background: rgba(0, 255, 136, 0.1); font-weight: bold; }
    </style>
</head>
<body>
<div class="container">
    <a href="/meccsek" class="back-btn">← VISSZA A MECCSEKHEZ</a>
    <div id="match-display">Betöltés...</div>
    <div class="analysis-grid">
        <div class="info-card"><h3>Tabella</h3><div id="standings-table">...</div></div>
        <div class="info-card"><h3>Odds</h3><div id="odds-display">...</div></div>
    </div>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const matchId = urlParams.get('id');

    async function loadAnalysis() {
        const resMatches = await fetch('/live-matches');
        const data = await resMatches.json();
        const match = data.matches.find(m => m.id == matchId);
        if (!match) return;

        renderHeader(match);
        renderStandings(match.competition.code, match.homeTeam.name, match.awayTeam.name);
        renderOdds(match.homeTeam.name, match.awayTeam.name);
    }

    function renderHeader(m) {
        document.getElementById('match-display').innerHTML = `
            <div class="match-header">
                <div class="team-big"><img src="${m.homeTeam.crest}"><h2>${m.homeTeam.name}</h2></div>
                <div style="font-size:3rem">${m.score.fullTime.home ?? 0}:${m.score.fullTime.away ?? 0}</div>
                <div class="team-big"><img src="${m.awayTeam.crest}"><h2>${m.awayTeam.name}</h2></div>
            </div>`;
    }

    async function renderStandings(code, home, away) {
        const res = await fetch(`/api/standings/${code}`);
        const data = await res.json();
        if(!data.standings) return;
        const table = data.standings[0].table;
        document.getElementById('standings-table').innerHTML = `<table>` + 
            table.map(r => `<tr class="${(r.team.name==home||r.team.name==away)?'highlight':''}"><td>${r.position}</td><td>${r.team.name}</td><td>${r.points}p</td></tr>`).join('') + `</table>`;
    }

    async function renderOdds(home, away) {
        const res = await fetch('/api/odds-data');
        const data = await res.json();
        const mOdds = data.find(o => o.home_team.includes(home.split(' ')[0]));
        if(!mOdds) return;
        const outcomes = mOdds.bookmakers[0].markets[0].outcomes;
        document.getElementById('odds-display').innerHTML = `<p>H: ${outcomes[0].price} | D: ${outcomes[1].price} | V: ${outcomes[2].price}</p>`;
    }
    loadAnalysis();
</script>
</body>
</html>
